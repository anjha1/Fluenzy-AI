generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  User
  Admin
  Modaretor
}

enum Plan {
  Free
  Pro
}

model users {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  email            String   @unique
  avatar           String?
  stripeCustomerId String?
  plan             Plan     @default(Free)
  role             Role     @default(User)
  usageCount       Int      @default(0)
  usageLimit       Int      @default(3)
  // Training module usage counters
  englishUsage     Int      @default(0)
  dailyUsage       Int      @default(0)
  hrUsage          Int      @default(0)
  technicalUsage   Int      @default(0)
  companyUsage     Int      @default(0)
  mockUsage        Int      @default(0)
  gdUsage          Int      @default(0)
  renewalDate      DateTime?
  sessions         Session[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model subscriptions {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  userId               String   @db.ObjectId
  stripeSubscriptionId String
  stripeCustomerId     String
  status               String   @default("active")
  currentPeriodEnd     DateTime?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Session {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionId      String   @unique
  userId         String   @db.ObjectId
  user           users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  module         String
  targetCompany  String?
  role           String?
  startTime      DateTime @default(now())
  endTime        DateTime?
  duration       Int? // in minutes
  aggregateScore Float?
  status         String? // PASS or FAIL
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  transcripts    Transcript[]
}

model Transcript {
  id                      String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionId               String   @db.ObjectId
  session                 Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  turnNumber              Int
  aiPrompt                String
  userAnswer              String // raw speech-to-text
  aiFeedback              String
  idealAnswer             String
  clarityScore            Float?
  relevanceScore          Float?
  grammarScore            Float?
  confidenceScore         Float?
  technicalAccuracyScore  Float?
  perQuestionScore        Float?
  createdAt               DateTime @default(now())
}